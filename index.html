<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VigoChat</title>

<style>
body{
margin:0;
font-family:Arial, sans-serif;
background:#0f172a;
color:white;
}

header{
background:#1e293b;
padding:15px;
text-align:center;
font-weight:bold;
}

nav{
position:fixed;
bottom:0;
width:100%;
background:#1e293b;
display:flex;
justify-content:space-around;
padding:10px 0;
}

nav button{
background:none;
border:none;
color:white;
font-size:14px;
}

.section{
display:none;
padding:15px;
padding-bottom:80px;
}

.active{
display:block;
}

input,textarea{
width:100%;
padding:10px;
margin:5px 0;
background:#334155;
border:none;
color:white;
}

button{
padding:10px;
background:#2563eb;
border:none;
color:white;
margin-top:5px;
}

.card{
background:#1e293b;
padding:10px;
margin:5px 0;
}
</style>
</head>
<body>

<header>VigoChat</header>

<div id="login" class="section active">
<h3>Giriş / Kayıt</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Şifre">
<button onclick="register()">Kayıt Ol</button>
<button onclick="login()">Giriş Yap</button>
</div>

<div id="chat" class="section">
<h3>Genel Sohbet</h3>
<div id="messages"></div>
<input id="msgInput" placeholder="Mesaj yaz">
<button onclick="sendMessage()">Gönder</button>
</div>

<div id="status" class="section">
<h3>Durum Ekle</h3>
<input id="statusInput" placeholder="Durum yaz">
<button onclick="addStatus()">Paylaş</button>
<div id="statusList"></div>
</div>

<div id="profile" class="section">
<h3>Profil</h3>
<input id="nameInput" placeholder="Ad Soyad">
<input id="birthdayInput" type="date">
<textarea id="bioInput" placeholder="Hakkında"></textarea>
<button onclick="saveProfile()">Kaydet</button>
<div id="profileInfo"></div>
</div>

<nav>
<button onclick="show('chat')">Sohbet</button>
<button onclick="show('status')">Durum</button>
<button onclick="show('profile')">Profil</button>
</nav>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA3--Xy1WrM6WlxurXXr4i5qwMZiafXN4k",
  authDomain: "vigochat-58144.firebaseapp.com",
  databaseURL: "https://vigochat-58144-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "vigochat-58144",
  storageBucket: "vigochat-58144.firebasestorage.app",
  messagingSenderId: "384136632816",
  appId: "1:384136632816:web:2bb6d6942680a2e2e6e535",
  measurementId: "G-62VZ3906GS"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getDatabase();

window.register = function(){
createUserWithEmailAndPassword(auth,email.value,password.value)
.then(()=>alert("Kayıt başarılı"))
.catch(e=>alert(e.message));
}

window.login = function(){
signInWithEmailAndPassword(auth,email.value,password.value)
.catch(e=>alert(e.message));
}

onAuthStateChanged(auth,user=>{
if(user){
show('chat');
loadMessages();
loadStatus();
loadProfile();
}
});

window.sendMessage = function(){
const user = auth.currentUser;
push(ref(db,'messages'),{
text:msgInput.value,
uid:user.uid
});
msgInput.value="";
}

function loadMessages(){
onValue(ref(db,'messages'),snap=>{
messages.innerHTML="";
snap.forEach(child=>{
let data=child.val();
messages.innerHTML+=`<div class="card">${data.text}</div>`;
});
});
}

window.addStatus = function(){
const user = auth.currentUser;
set(ref(db,'status/'+user.uid),{
text:statusInput.value
});
statusInput.value="";
}

function loadStatus(){
onValue(ref(db,'status'),snap=>{
statusList.innerHTML="";
snap.forEach(child=>{
let data=child.val();
statusList.innerHTML+=`<div class="card">${data.text}</div>`;
});
});
}

window.saveProfile = function(){
const user = auth.currentUser;
set(ref(db,'users/'+user.uid),{
name:nameInput.value,
birthday:birthdayInput.value,
bio:bioInput.value
});
alert("Profil kaydedildi");
}

function loadProfile(){
const user = auth.currentUser;
onValue(ref(db,'users/'+user.uid),snap=>{
if(snap.exists()){
let data=snap.val();
profileInfo.innerHTML=
`<div class="card">
İsim: ${data.name}<br>
Doğum: ${data.birthday}<br>
Bio: ${data.bio}
</div>`;
}
});
}

window.show=function(id){
document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
document.getElementById(id).classList.add('active');
}
</script>

</body>
</html>
