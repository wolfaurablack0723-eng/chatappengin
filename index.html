<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>ARKO AI Platform</title>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1020;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.09);
      --stroke:rgba(255,255,255,.10);
      --text:#F4F7FF;
      --muted:rgba(255,255,255,.65);
      --accent:#00E676;
      --danger:#FF4D4D;
      --warn:#FFB020;
      --shadow:0 18px 50px rgba(0,0,0,.55);
      --r16:16px;
      --r22:22px;
      --safeT: env(safe-area-inset-top, 0px);
      --safeB: env(safe-area-inset-bottom, 0px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 20% -10%, rgba(0,230,118,.18), transparent 55%),
        radial-gradient(900px 520px at 90% 0%, rgba(43,108,255,.16), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* TOPBAR */
    .topbar{
      position:sticky; top:0;
      padding: calc(10px + var(--safeT)) 14px 10px 14px;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(5,8,15,.75), rgba(5,8,15,.25));
      border-bottom:1px solid var(--stroke);
      z-index:50;
    }
    .toprow{display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .brand{display:flex; align-items:center; gap:10px;}
    .logo{
      width:38px;height:38px;border-radius:12px;
      background: linear-gradient(135deg, rgba(0,230,118,.9), rgba(255,176,32,.9));
      box-shadow: 0 10px 25px rgba(0,230,118,.18);
    }
    .brand h1{font-size:16px; margin:0; letter-spacing:.3px}
    .brand .sub{font-size:12px; color:var(--muted); margin-top:2px}

    .iconBtn{
      appearance:none; border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
    }

    /* LAYOUT */
    .wrap{max-width:1100px; margin:0 auto; padding:14px;}
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      padding-bottom: calc(18px + var(--safeB));
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.05));
      border:1px solid var(--stroke);
      border-radius: var(--r22);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card h2{margin:0 0 8px 0; font-size:16px}
    .muted{color:var(--muted); font-size:12px; line-height:1.5}

    .row{display:flex; gap:10px; flex-wrap:wrap}
    .stat{
      flex:1; min-width:140px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      border-radius:18px;
      padding:12px;
    }
    .stat .n{font-size:20px; font-weight:950}
    .stat .t{font-size:12px; color:var(--muted); margin-top:3px}

    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}
    input, textarea, select{
      width:100%;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.22);
      color:var(--text);
      padding:12px 12px;
      outline:none;
    }
    textarea{min-height:110px; resize:vertical}

    .btn{
      border:0;
      border-radius:16px;
      padding:12px 14px;
      font-weight:950;
      cursor:pointer;
      color:#07110B;
      background: var(--accent);
    }
    .btn2{
      border:1px solid var(--stroke);
      border-radius:16px;
      padding:12px 14px;
      font-weight:900;
      cursor:pointer;
      color:var(--text);
      background: rgba(255,255,255,.06);
    }
    .btnDanger{background:var(--danger); color:white}
    .btnWarn{background:var(--warn); color:#1a1203}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
    }

    /* DRAWER MENU */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      opacity:0; pointer-events:none;
      transition: .18s ease;
      z-index:80;
    }
    .overlay.on{opacity:1; pointer-events:auto}

    .drawer{
      position:fixed;
      top:0; left:0;
      height:100%;
      width:min(330px, 88vw);
      transform: translateX(-110%);
      transition:.22s ease;
      z-index:90;
      padding: calc(14px + var(--safeT)) 14px 14px 14px;
      background:
        radial-gradient(700px 380px at 20% -10%, rgba(0,230,118,.18), transparent 60%),
        linear-gradient(180deg, rgba(10,14,26,.98), rgba(8,10,16,.98));
      border-right:1px solid var(--stroke);
    }
    .drawer.on{transform: translateX(0)}
    .drawerHead{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:12px}
    .drawerTitle{display:flex; align-items:center; gap:10px}
    .drawerTitle b{font-size:14px}
    .menu{
      display:flex; flex-direction:column; gap:8px;
      margin-top:10px;
    }
    .mi{
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
      display:flex; justify-content:space-between; align-items:center;
    }
    .mi small{color:var(--muted); font-weight:700}
    .mi.active{
      background: rgba(0,230,118,.16);
      border-color: rgba(0,230,118,.35);
    }

    /* MODAL */
    .modal{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      padding:16px; z-index:120;
    }
    .modal.on{display:flex}
    .modalBox{
      width:min(900px, 100%);
      max-height: 78vh;
      overflow:auto;
      background: rgba(10,12,18,.96);
      border:1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: var(--shadow);
    }
    .modalTop{
      position:sticky; top:0;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding:12px 14px;
      background: rgba(10,12,18,.92);
      border-bottom:1px solid var(--stroke);
    }
    .modalBody{padding:14px}
    pre{white-space:pre-wrap; word-break:break-word}

    /* DESKTOP */
    @media (min-width: 980px){
      .grid{grid-template-columns: 1.1fr .9fr;}
      .topbar{position:sticky}
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="toprow">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>ARKO AI Platform</h1>
          <div class="sub" id="subLine">TÃ¼rkÃ§e â€¢ Mobil uyumlu â€¢ Demo</div>
        </div>
      </div>
      <button class="iconBtn" id="menuBtn">â˜° MenÃ¼</button>
    </div>
  </div>

  <div class="overlay" id="overlay"></div>

  <aside class="drawer" id="drawer">
    <div class="drawerHead">
      <div class="drawerTitle">
        <div class="logo" style="width:34px;height:34px;border-radius:12px"></div>
        <div>
          <b>MenÃ¼</b>
          <div class="muted" id="userLine">KullanÄ±cÄ±: -</div>
        </div>
      </div>
      <button class="iconBtn" id="closeDrawer">âœ•</button>
    </div>

    <div class="menu" id="menuList"></div>

    <div style="margin-top:12px" class="card">
      <div class="pill">ğŸ’³ Kredi: <b id="creditPill">0</b></div>
      <div style="height:8px"></div>
      <button class="btn2" id="add10">+10 Kredi (Demo)</button>
    </div>

    <div class="muted" style="margin-top:10px">
      Bu sÃ¼rÃ¼m frontend demo. GerÃ§ek AI iÃ§in sonra API baÄŸlarÄ±z.
    </div>
  </aside>

  <main class="wrap">
    <div class="grid">
      <section id="pageMain" class="card"></section>
      <section id="pageSide" class="card"></section>
    </div>
  </main>

  <!-- MODAL -->
  <div class="modal" id="modal">
    <div class="modalBox">
      <div class="modalTop">
        <b id="mTitle">Detay</b>
        <button class="btn2" id="mClose">Kapat</button>
      </div>
      <div class="modalBody" id="mBody"></div>
      <div class="modalTop" style="border-top:1px solid var(--stroke); border-bottom:0">
        <button class="btn2" id="mCopy">Kopyala</button>
        <button class="btn2" id="mDownload">JSON indir</button>
        <button class="btn btnDanger" id="mDelete">Sil</button>
      </div>
    </div>
  </div>
  <script>
/* =========================
   KALICI VERÄ° (LocalStorage)
========================= */
const LS = {
  projects: "arko_tr_projects",
  settings: "arko_tr_settings",
  admin: "arko_tr_admin",
  onboard: "arko_tr_onboard"
};

const state = {
  user: { name: "Engin", plan: "Ãœcretsiz", credits: 5, isAdmin: true },
  projects: safeJSON(localStorage.getItem(LS.projects), []),
  logs: [],
  settings: safeJSON(localStorage.getItem(LS.settings), { accent:"#00E676" }),
  admin: safeJSON(localStorage.getItem(LS.admin), {
    maintenance:false,
    features:{ dashboard:true, voice:true, ideas:true, projects:true, settings:true, admin:true },
    costs:{ voice:1, ideas:1 }
  }),
  ui: { page:"dashboard", modalProjectId:null }
};

function safeJSON(txt, fallback){
  try{ return txt ? JSON.parse(txt) : fallback; }catch{ return fallback; }
}
function persist(){
  localStorage.setItem(LS.projects, JSON.stringify(state.projects));
  localStorage.setItem(LS.settings, JSON.stringify(state.settings));
  localStorage.setItem(LS.admin, JSON.stringify(state.admin));
}
function esc(s){
  return (s??"").toString()
    .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;").replace(/'/g,"&#039;");
}
function logIt(msg){
  state.logs.unshift(new Date().toLocaleString()+" â€¢ "+msg);
  if(state.logs.length>200) state.logs.pop();
}

/* =========================
   DRAWER / MODAL
========================= */
const drawer = document.getElementById("drawer");
const overlay = document.getElementById("overlay");
const menuBtn = document.getElementById("menuBtn");
const closeDrawerBtn = document.getElementById("closeDrawer");

function openDrawer(){
  drawer.classList.add("on");
  overlay.classList.add("on");
}
function closeDrawer(){
  drawer.classList.remove("on");
  overlay.classList.remove("on");
}
menuBtn.onclick = openDrawer;
closeDrawerBtn.onclick = closeDrawer;
overlay.onclick = closeDrawer;

const modal = document.getElementById("modal");
const mTitle = document.getElementById("mTitle");
const mBody = document.getElementById("mBody");
document.getElementById("mClose").onclick = ()=> modal.classList.remove("on");

let modalDownload = { text:"", filename:"arko.json" };
document.getElementById("mCopy").onclick = ()=>{
  const t = mBody.innerText || "";
  (navigator.clipboard?.writeText(t) || Promise.reject())
    .then(()=>alert("KopyalandÄ± âœ…"))
    .catch(()=>alert("Kopyalama olmadÄ± (elle seÃ§)."));
};
document.getElementById("mDownload").onclick = ()=>{
  const blob = new Blob([modalDownload.text], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = modalDownload.filename;
  a.click();
  URL.revokeObjectURL(a.href);
};
document.getElementById("mDelete").onclick = ()=>{
  const id = state.ui.modalProjectId;
  if(!id) return alert("Silinecek proje yok.");
  if(!confirm("Silinsin mi?")) return;
  const idx = state.projects.findIndex(p=>p.id===id);
  if(idx>=0){
    logIt("Proje silindi: "+(state.projects[idx].title||id));
    state.projects.splice(idx,1);
    persist();
    modal.classList.remove("on");
    render();
  }
};

/* =========================
   MENÃœ + ROUTER
========================= */
const MENU = [
  { id:"dashboard",  tr:"Dashboard",  icon:"ğŸ ", desc:"Ã–zet & kredi" },
  { id:"voice",      tr:"Ses StÃ¼dyosu",icon:"ğŸ¤", desc:"Cihaz TTS" },
  { id:"ideas",      tr:"Fikir StÃ¼dyosu",icon:"ğŸ§ ", desc:"Plan Ã¼ret" },
  { id:"projects",   tr:"Projeler",   icon:"ğŸ“", desc:"Kaydet/Export" },
  { id:"settings",   tr:"Ayarlar",    icon:"âš™ï¸", desc:"Tema/Yedek" },
  { id:"admin",      tr:"Admin",      icon:"ğŸ›¡ï¸", desc:"Kontrol" }
];

function go(page){
  // bakÄ±m modu
  if(state.admin.maintenance && !state.user.isAdmin){
    alert("Sistem bakÄ±mda. Sonra tekrar dene.");
    return;
  }
  // feature toggle
  if(!state.admin.features[page]){
    alert("Bu bÃ¶lÃ¼m admin tarafÄ±ndan kapalÄ±.");
    return;
  }
  state.ui.page = page;
  closeDrawer();
  render();
}

function renderMenu(){
  const list = document.getElementById("menuList");
  list.innerHTML = MENU.map(m=>{
    const on = state.ui.page===m.id ? "active" : "";
    return `<div class="mi ${on}" data-page="${m.id}">
      <span>${m.icon} ${m.tr}</span>
      <small>${m.desc}</small>
    </div>`;
  }).join("");
  list.querySelectorAll(".mi").forEach(el=>{
    el.onclick = ()=> go(el.getAttribute("data-page"));
  });

  document.getElementById("userLine").textContent =
    `KullanÄ±cÄ±: ${state.user.name} â€¢ Plan: ${state.user.plan}`;
  document.getElementById("creditPill").textContent = String(state.user.credits);
}

function spend(cost){
  if(state.user.credits < cost){
    alert("Kredi yetersiz.");
    logIt("Kredi yetersiz denemesi");
    return false;
  }
  state.user.credits -= cost;
  document.getElementById("creditPill").textContent = String(state.user.credits);
  return true;
}

document.getElementById("add10").onclick = ()=>{
  state.user.credits += 10;
  logIt("+10 kredi yÃ¼klendi (demo)");
  render();
};

function openProjectModal(p){
  state.ui.modalProjectId = p.id;
  const txt = JSON.stringify(p, null, 2);
  mTitle.textContent = "Proje DetayÄ±";
  mBody.innerHTML = `
    <div class="pill">ğŸ“Œ ${esc(p.type)} â€¢ ${new Date(p.createdAt).toLocaleString()}</div>
    <div style="height:10px"></div>
    <b>${esc(p.title||"Ä°simsiz")}</b>
    <div style="height:12px"></div>
    <pre>${esc(txt)}</pre>
  `;
  modalDownload = { text: txt, filename: (p.id||"project")+".json" };
  modal.classList.add("on");
}
</script>
<script>
function renderDashboard(){
  const main = document.getElementById("pageMain");
  const side = document.getElementById("pageSide");

  main.innerHTML = `
    <h2>ğŸ  Dashboard</h2>
    <div class="muted">HoÅŸ geldin <b>${esc(state.user.name)}</b>. Kredi ve projelerini buradan yÃ¶net.</div>
    <div style="height:12px"></div>

    <div class="row">
      <div class="stat">
        <div class="n">${state.user.credits}</div>
        <div class="t">Kredi</div>
      </div>
      <div class="stat">
        <div class="n">${state.projects.length}</div>
        <div class="t">Projeler</div>
      </div>
      <div class="stat">
        <div class="n">${state.logs.length}</div>
        <div class="t">Log</div>
      </div>
    </div>

    <div style="height:12px"></div>
    <div class="card" style="box-shadow:none">
      <div class="pill">âš¡ HÄ±zlÄ± Ä°ÅŸlemler</div>
      <div style="height:10px"></div>
      <div class="row">
        <button class="btn" onclick="go('voice')">ğŸ¤ Ses StÃ¼dyosu</button>
        <button class="btn2" onclick="go('ideas')">ğŸ§  Fikir StÃ¼dyosu</button>
        <button class="btn2" onclick="go('projects')">ğŸ“ Projeler</button>
      </div>
    </div>
  `;

  side.innerHTML = `
    <h2>ğŸ“Œ Durum</h2>
    <div class="muted">Plan: <b>${esc(state.user.plan)}</b> â€¢ Admin: <b>${state.user.isAdmin?"Evet":"HayÄ±r"}</b></div>
    <div style="height:12px"></div>
    <div class="card" style="box-shadow:none">
      <div class="muted">Son loglar</div>
      <div style="height:8px"></div>
      ${state.logs.slice(0,6).map(x=>`<div class="pill">ğŸ§¾ ${esc(x)}</div>`).join("") || `<div class="muted">HenÃ¼z yok.</div>`}
    </div>
  `;
}

let ttsVoices = [];
function loadVoices(){
  try{
    ttsVoices = speechSynthesis.getVoices() || [];
  }catch{ ttsVoices = []; }
}

function renderVoice(){
  const main = document.getElementById("pageMain");
  const side = document.getElementById("pageSide");

  main.innerHTML = `
    <h2>ğŸ¤ Ses StÃ¼dyosu</h2>
    <div class="muted">CihazÄ±n kendi TTS sesleri ile metni okur. (Klon deÄŸil)</div>

    <label>Metin</label>
    <textarea id="ttsText" placeholder="Ã–rn: Merhaba, ben Arko!"></textarea>

    <div class="row">
      <div class="stat" style="min-width:220px">
        <div class="t">Ses</div>
        <select id="ttsVoice"></select>
      </div>
      <div class="stat" style="min-width:220px">
        <div class="t">HÄ±z</div>
        <input id="ttsRate" type="range" min="0.6" max="1.4" step="0.1" value="1.0">
        <div class="muted">SeÃ§ilen: <span id="rVal">1.0</span></div>
      </div>
      <div class="stat" style="min-width:220px">
        <div class="t">Ton</div>
        <input id="ttsPitch" type="range" min="0.6" max="1.4" step="0.1" value="1.0">
        <div class="muted">SeÃ§ilen: <span id="pVal">1.0</span></div>
      </div>
    </div>

    <div style="height:10px"></div>
    <div class="row">
      <button class="btn" id="speakBtn">â–¶ï¸ Seslendir (${state.admin.costs.voice} kredi)</button>
      <button class="btn2" id="stopBtn">â¹ Durdur</button>
      <button class="btn2" id="saveVoiceBtn">ğŸ’¾ Proje Kaydet</button>
    </div>

    <div style="height:12px"></div>
    <div class="card" style="box-shadow:none">
      <div class="pill">âœ… Ã‡Ä±ktÄ±</div>
      <div style="height:8px"></div>
      <div class="muted" id="ttsOut">HenÃ¼z yok.</div>
    </div>
  `;

  side.innerHTML = `
    <h2>Ä°pucu</h2>
    <div class="muted">
      EÄŸer ses listesi boÅŸsa:<br>
      â€¢ SayfayÄ± yenile<br>
      â€¢ Telefonun â€œMetin Okuma (TTS)â€ ayarÄ±nÄ± kontrol et
    </div>
  `;

  loadVoices();
  const sel = document.getElementById("ttsVoice");
  sel.innerHTML = (ttsVoices.length
    ? ttsVoices.map((v,i)=>`<option value="${i}">${esc(v.name)}</option>`).join("")
    : `<option value="0">Ses bulunamadÄ±</option>`);

  const rate = document.getElementById("ttsRate");
  const pitch = document.getElementById("ttsPitch");
  rate.oninput = ()=> document.getElementById("rVal").textContent = rate.value;
  pitch.oninput = ()=> document.getElementById("pVal").textContent = pitch.value;

  document.getElementById("stopBtn").onclick = ()=> { try{speechSynthesis.cancel()}catch{} logIt("TTS durduruldu"); };
  document.getElementById("speakBtn").onclick = ()=>{
    if(!state.admin.features.voice) return alert("Ses StÃ¼dyosu kapalÄ±.");
    const cost = Number(state.admin.costs.voice||1);
    const text = (document.getElementById("ttsText").value||"").trim();
    if(!text) return alert("Metin yaz.");
    if(!("speechSynthesis" in window)) return alert("Bu cihaz TTS desteklemiyor.");
    if(!spend(cost)) return;

    const u = new SpeechSynthesisUtterance(text);
    const idx = Number(sel.value||0);
    const voices = speechSynthesis.getVoices() || [];
    if(voices[idx]) u.voice = voices[idx];
    u.rate = Number(rate.value||1);
    u.pitch = Number(pitch.value||1);

    try{ speechSynthesis.cancel(); speechSynthesis.speak(u); }catch{}
    document.getElementById("ttsOut").innerHTML =
      `<b>Seslendiriliyorâ€¦</b><br><span class="muted">${esc(text)}</span>`;
    logIt("TTS Ã§alÄ±ÅŸtÄ± (-"+cost+" kredi)");
    renderMenu();
  };

  document.getElementById("saveVoiceBtn").onclick = ()=>{
    const text = (document.getElementById("ttsText").value||"").trim();
    if(!text) return alert("Metin yaz.");
    const p = {
      id:"voice_"+Date.now(),
      type:"Ses",
      title: (text.slice(0,42) + (text.length>42?"â€¦":"")),
      createdAt: Date.now(),
      payload: {
        text,
        voiceIndex: Number(sel.value||0),
        rate:Number(rate.value||1),
        pitch:Number(pitch.value||1)
      }
    };
    state.projects.unshift(p);
    persist();
    logIt("Ses projesi kaydedildi");
    renderMenu();
    alert("Kaydedildi âœ…");
  };
}

function renderIdeas(){
  const main = document.getElementById("pageMain");
  const side = document.getElementById("pageSide");

  main.innerHTML = `
    <h2>ğŸ§  Fikir StÃ¼dyosu</h2>
    <div class="muted">Profesyonel formatta plan Ã¼retir (demo). Sonra gerÃ§ek AI baÄŸlanÄ±r.</div>

    <label>Uygulama fikri</label>
    <textarea id="ideaTxt" placeholder="Ã–rn: KuafÃ¶r randevu + Ã¶deme + hatÄ±rlatma"></textarea>

    <div class="row">
      <div class="stat" style="min-width:220px">
        <div class="t">Kategori</div>
        <select id="cat">
          <option>Yerel Hizmet</option><option>E-ticaret</option><option>Sosyal</option>
          <option>EÄŸitim</option><option>SaÄŸlÄ±k</option><option>Ä°ÅŸ/CRM</option>
        </select>
      </div>
      <div class="stat" style="min-width:220px">
        <div class="t">Gelir Modeli</div>
        <select id="mon">
          <option>Freemium</option><option>Abonelik</option><option>Reklam</option><option>Komisyon</option>
        </select>
      </div>
    </div>

    <div style="height:10px"></div>
    <div class="row">
      <button class="btn" id="genPlan">âš¡ Plan Ãœret (${state.admin.costs.ideas} kredi)</button>
      <button class="btn2" id="saveIdea">ğŸ’¾ Projeye Kaydet</button>
    </div>

    <div style="height:12px"></div>
    <div class="card" style="box-shadow:none">
      <div class="pill">ğŸ“„ Ãœretilen Plan</div>
      <div style="height:8px"></div>
      <div class="muted" id="ideaOut">HenÃ¼z plan yok.</div>
    </div>
  `;

  side.innerHTML = `
    <h2>Ã–neri</h2>
    <div class="muted">
      Ä°yi Ã§Ä±ktÄ± iÃ§in fikre ÅŸu bilgileri ekle:<br>
      â€¢ hedef kitle<br>
      â€¢ rakipler<br>
      â€¢ fiyat<br>
      â€¢ en Ã¶nemli 3 Ã¶zellik
    </div>
  `;

  let lastPlan = null;

  document.getElementById("genPlan").onclick = ()=>{
    if(!state.admin.features.ideas) return alert("Fikir StÃ¼dyosu kapalÄ±.");
    const cost = Number(state.admin.costs.ideas||1);
    const idea = (document.getElementById("ideaTxt").value||"").trim();
    if(!idea) return alert("Fikir yaz.");
    if(!spend(cost)) return;

    const cat = document.getElementById("cat").value;
    const mon = document.getElementById("mon").value;

    const mvp = [
      "KayÄ±t/GiriÅŸ + profil",
      "Ana akÄ±ÅŸ (temel ekranlar)",
      "Bildirim/hatÄ±rlatma",
      "Admin panel (temel)",
      "Raporlama/istatistik"
    ].sort(()=>0.5-Math.random()).slice(0,4);

    const roadmap = [
      "Hafta 1: TasarÄ±m + MVP ekranlarÄ±",
      "Hafta 2: Proje/DB + API",
      "Hafta 3: Ã–deme/kredi + gÃ¼venlik",
      "Hafta 4: YayÄ±n + kullanÄ±cÄ± toplama"
    ];

    lastPlan = { idea, cat, mon, mvp, roadmap };

    document.getElementById("ideaOut").innerHTML = `
      <b>${esc(idea)}</b><br>
      <span class="pill">ğŸ“¦ ${esc(cat)}</span>
      <span class="pill">ğŸ’° ${esc(mon)}</span>
      <div style="height:10px"></div>
      <b>MVP:</b><ul>${mvp.map(x=>`<li>${esc(x)}</li>`).join("")}</ul>
      <b>Roadmap:</b><ul>${roadmap.map(x=>`<li>${esc(x)}</li>`).join("")}</ul>
    `;

    logIt("Plan Ã¼retildi (-"+cost+" kredi)");
    renderMenu();
  };

  document.getElementById("saveIdea").onclick = ()=>{
    const idea = (document.getElementById("ideaTxt").value||"").trim();
    if(!idea) return alert("Fikir yaz.");
    const p = {
      id:"idea_"+Date.now(),
      type:"Fikir",
      title: (idea.slice(0,42) + (idea.length>42?"â€¦":"")),
      createdAt: Date.now(),
      payload: lastPlan || { idea }
    };
    state.projects.unshift(p);
    persist();
    logIt("Fikir projesi kaydedildi");
    renderMenu();
    alert("Kaydedildi âœ…");
  };
}

function renderProjects(){
  const main = document.getElementById("pageMain");
  const side = document.getElementById("pageSide");

  main.innerHTML = `
    <h2>ğŸ“ Projeler</h2>
    <div class="muted">Arama, aÃ§, sil, export/import.</div>

    <label>Ara</label>
    <input id="q" placeholder="baÅŸlÄ±k / iÃ§erik">

    <div class="row">
      <button class="btn2" id="exportBtn">â¬‡ï¸ Export JSON</button>
      <button class="btn2" id="importBtn">â¬†ï¸ Import JSON</button>
      <button class="btn btnDanger" id="clearBtn">ğŸ—‘ Hepsini Sil</button>
    </div>

    <div style="height:12px"></div>
    <div id="plist"></div>
  `;

  side.innerHTML = `
    <h2>Log</h2>
    <div class="muted">${state.logs.slice(0,10).map(x=>`<div class="pill">ğŸ§¾ ${esc(x)}</div>`).join("") || "HenÃ¼z yok."}</div>
  `;

  const plist = document.getElementById("plist");
  const q = document.getElementById("q");

  function draw(){
    const s = (q.value||"").toLowerCase();
    const items = state.projects.filter(p=>{
      const a = (p.title||"").toLowerCase();
      const b = JSON.stringify(p.payload||{}).toLowerCase();
      return !s || a.includes(s) || b.includes(s);
    });

    plist.innerHTML = items.map(p=>`
      <div class="card" style="box-shadow:none; margin-top:10px">
        <div class="pill">ğŸ§© ${esc(p.type)} â€¢ ${new Date(p.createdAt).toLocaleString()}</div>
        <div style="height:8px"></div>
        <b style="font-size:14px">${esc(p.title||"Ä°simsiz")}</b>
        <div style="height:10px"></div>
        <div class="row">
          <button class="btn2" data-open="${p.id}">AÃ§</button>
          <button class="btn btnDanger" data-del="${p.id}">Sil</button>
        </div>
      </div>
    `).join("") || `<div class="muted">Proje yok.</div>`;

    plist.querySelectorAll("[data-open]").forEach(b=>{
      b.onclick = ()=>{
        const p = state.projects.find(x=>x.id===b.getAttribute("data-open"));
        if(p) openProjectModal(p);
      };
    });
    plist.querySelectorAll("[data-del]").forEach(b=>{
      b.onclick = ()=>{
        const id = b.getAttribute("data-del");
        if(!confirm("Silinsin mi?")) return;
        const idx = state.projects.findIndex(x=>x.id===id);
        if(idx>=0){
          logIt("Proje silindi: "+(state.projects[idx].title||id));
          state.projects.splice(idx,1);
          persist();
          render();
        }
      };
    });
  }

  q.oninput = draw;
  draw();

  document.getElementById("exportBtn").onclick = ()=>{
    const txt = JSON.stringify(state.projects, null, 2);
    state.ui.modalProjectId = null;
    mTitle.textContent = "Export (Projeler)";
    mBody.innerHTML = `<pre>${esc(txt)}</pre>`;
    modalDownload = { text: txt, filename:"arko-projects.json" };
    modal.classList.add("on");
    document.getElementById("mDelete").onclick = ()=> alert("Export ekranÄ±nda silme yok.");
  };

  document.getElementById("importBtn").onclick = ()=>{
    const txt = prompt("JSON yapÄ±ÅŸtÄ±r (projects array):");
    if(!txt) return;
    try{
      const arr = JSON.parse(txt);
      if(!Array.isArray(arr)) throw new Error("Array deÄŸil");
      const cleaned = arr.map(p=>({
        id: p.id || ("imp_"+Date.now()+Math.random()),
        type: p.type || "Imported",
        title: p.title || "Imported",
        createdAt: p.createdAt || Date.now(),
        payload: p.payload || {}
      }));
      state.projects = [...cleaned, ...state.projects];
      persist();
      logIt("Import: "+cleaned.length+" proje");
      render();
      alert("Ä°Ã§e aktarÄ±ldÄ± âœ…");
    }catch(e){
      alert("JSON hatalÄ±: "+e.message);
    }
  };

  document.getElementById("clearBtn").onclick = ()=>{
    if(!confirm("TÃ¼m projeler silinsin mi?")) return;
    state.projects = [];
    persist();
    logIt("TÃ¼m projeler silindi");
    render();
  };
}
</script>
<script>
function renderSettings(){
  const main = document.getElementById("pageMain");
  const side = document.getElementById("pageSide");

  main.innerHTML = `
    <h2>âš™ï¸ Ayarlar</h2>
    <div class="muted">Tema rengi, yedekleme, sÄ±fÄ±rlama.</div>

    <label>KullanÄ±cÄ± AdÄ±</label>
    <input id="nm" value="${esc(state.user.name)}">

    <label>Plan</label>
    <select id="pl">
      <option ${state.user.plan==="Ãœcretsiz"?"selected":""}>Ãœcretsiz</option>
      <option ${state.user.plan==="Pro"?"selected":""}>Pro</option>
      <option ${state.user.plan==="Business"?"selected":""}>Business</option>
    </select>

    <label>Accent renk</label>
    <input id="ac" type="color" value="${state.settings.accent || "#00E676"}">

    <div class="row">
      <button class="btn" id="saveSet">Kaydet</button>
      <button class="btn2" id="backup">Backup Export</button>
      <button class="btn2" id="restore">Backup Import</button>
      <button class="btn btnDanger" id="reset">Factory Reset</button>
    </div>
  `;

  side.innerHTML = `
    <h2>Bilgi</h2>
    <div class="muted">
      â€¢ Bu sÃ¼rÃ¼m mobil uyumlu<br>
      â€¢ Veriler cihazÄ±nda saklanÄ±r<br>
      â€¢ GerÃ§ek AI iÃ§in backend gerekir
    </div>
  `;

  document.getElementById("saveSet").onclick = ()=>{
    state.user.name = (document.getElementById("nm").value||"Engin").trim() || "Engin";
    state.user.plan = document.getElementById("pl").value;
    state.settings.accent = document.getElementById("ac").value || "#00E676";
    document.documentElement.style.setProperty("--accent", state.settings.accent);
    persist();
    logIt("Ayarlar kaydedildi");
    render();
    alert("Kaydedildi âœ…");
  };

  document.getElementById("backup").onclick = ()=>{
    const pack = {
      v:"arko-tr-1",
      user: state.user,
      settings: state.settings,
      admin: state.admin,
      projects: state.projects,
      logs: state.logs,
      at: Date.now()
    };
    const txt = JSON.stringify(pack, null, 2);
    state.ui.modalProjectId = null;
    mTitle.textContent = "Backup Export";
    mBody.innerHTML = `<pre>${esc(txt)}</pre>`;
    modalDownload = { text: txt, filename:"arko-backup.json" };
    modal.classList.add("on");
  };

  document.getElementById("restore").onclick = ()=>{
    const txt = prompt("Backup JSON yapÄ±ÅŸtÄ±r:");
    if(!txt) return;
    try{
      const b = JSON.parse(txt);
      if(!b || !b.projects) throw new Error("GeÃ§ersiz backup");
      state.projects = Array.isArray(b.projects) ? b.projects : state.projects;
      state.settings = b.settings || state.settings;
      state.admin = b.admin || state.admin;
      state.user = b.user ? {...state.user, ...b.user} : state.user;
      state.logs = Array.isArray(b.logs) ? b.logs : state.logs;
      persist();
      document.documentElement.style.setProperty("--accent", state.settings.accent || "#00E676");
      logIt("Backup import yapÄ±ldÄ±");
      render();
      alert("YÃ¼klendi âœ…");
    }catch(e){
      alert("Backup hatalÄ±: "+e.message);
    }
  };

  document.getElementById("reset").onclick = ()=>{
    if(!confirm("Her ÅŸey silinsin mi?")) return;
    localStorage.removeItem(LS.projects);
    localStorage.removeItem(LS.settings);
    localStorage.removeItem(LS.admin);
    state.projects = [];
    state.logs = [];
    state.user.credits = 5;
    state.settings = { accent:"#00E676" };
    state.admin = {
      maintenance:false,
      features:{ dashboard:true, voice:true, ideas:true, projects:true, settings:true, admin:true },
      costs:{ voice:1, ideas:1 }
    };
    persist();
    logIt("Factory reset");
    render();
  };
}

function renderAdmin(){
  const main = document.getElementById("pageMain");
  const side = document.getElementById("pageSide");

  if(!state.user.isAdmin){
    main.innerHTML = `<h2>ğŸ›¡ï¸ Admin</h2><div class="muted">Yetkin yok.</div>`;
    side.innerHTML = `<div class="muted">Admin aÃ§mak iÃ§in koddan state.user.isAdmin=true</div>`;
    return;
  }

  main.innerHTML = `
    <h2>ğŸ›¡ï¸ Admin Panel</h2>
    <div class="muted">Ã–zellik aÃ§/kapat, bakÄ±m modu, kredi maliyetleri.</div>

    <div style="height:10px"></div>
    <div class="row">
      <div class="stat">
        <div class="n">${state.admin.maintenance ? "BAKIM" : "AKTÄ°F"}</div>
        <div class="t">Sistem</div>
      </div>
      <div class="stat">
        <div class="n">${state.user.credits}</div>
        <div class="t">KullanÄ±cÄ± Kredisi</div>
      </div>
      <div class="stat">
        <div class="n">${state.projects.length}</div>
        <div class="t">Projeler</div>
      </div>
    </div>

    <label>BakÄ±m modu</label>
    <button class="btn2" id="mnt">${state.admin.maintenance?"BakÄ±mÄ± Kapat":"BakÄ±mÄ± AÃ§"}</button>

    <label>Ã–zellikler</label>
    <div class="row" id="ft"></div>

    <label>Kredi maliyeti</label>
    <div class="row">
      <div class="stat" style="min-width:220px">
        <div class="t">Ses StÃ¼dyosu</div>
        <input id="cVoice" type="number" min="0" value="${state.admin.costs.voice}">
      </div>
      <div class="stat" style="min-width:220px">
        <div class="t">Fikir StÃ¼dyosu</div>
        <input id="cIdeas" type="number" min="0" value="${state.admin.costs.ideas}">
      </div>
    </div>

    <div class="row">
      <button class="btn" id="saveAdmin">Kaydet</button>
      <button class="btn2" id="give50">+50 kredi</button>
      <button class="btn btnDanger" id="wipeLogs">Log temizle</button>
    </div>
  `;

  side.innerHTML = `
    <h2>Not</h2>
    <div class="muted">
      Feature kapalÄ±ysa menÃ¼den girilmez.<br>
      BakÄ±m modunda admin dÄ±ÅŸÄ± iÅŸlem yapamaz.
    </div>
  `;

  // feature buttons
  const ft = document.getElementById("ft");
  ft.innerHTML = Object.keys(state.admin.features).map(k=>{
    const on = state.admin.features[k];
    return `<button class="${on?'btn2':'btn btnDanger'}" data-k="${k}">${k}: ${on?'AÃ§Ä±k':'KapalÄ±'}</button>`;
  }).join("");

  ft.querySelectorAll("button").forEach(b=>{
    b.onclick = ()=>{
      const k = b.getAttribute("data-k");
      state.admin.features[k] = !state.admin.features[k];
      persist();
      render();
    };
  });

  document.getElementById("mnt").onclick = ()=>{
    state.admin.maintenance = !state.admin.maintenance;
    persist();
    render();
  };

  document.getElementById("saveAdmin").onclick = ()=>{
    state.admin.costs.voice = Math.max(0, Number(document.getElementById("cVoice").value||1));
    state.admin.costs.ideas = Math.max(0, Number(document.getElementById("cIdeas").value||1));
    persist();
    logIt("Admin ayarlarÄ± kaydedildi");
    render();
    alert("Kaydedildi âœ…");
  };

  document.getElementById("give50").onclick = ()=>{
    state.user.credits += 50;
    logIt("+50 kredi verildi");
    render();
  };

  document.getElementById("wipeLogs").onclick = ()=>{
    if(!confirm("Loglar silinsin mi?")) return;
    state.logs = [];
    logIt("Log temizlendi");
    render();
  };
}

function render(){
  document.documentElement.style.setProperty("--accent", state.settings.accent || "#00E676");
  document.getElementById("subLine").textContent = "TÃ¼rkÃ§e â€¢ Mobil uyumlu â€¢ Demo";
  renderMenu();

  const p = state.ui.page;

  // saÄŸ panel: sayfaya gÃ¶re
  if(p==="dashboard") return renderDashboard();
  if(p==="voice") return renderVoice();
  if(p==="ideas") return renderIdeas();
  if(p==="projects") return renderProjects();
  if(p==="settings") return renderSettings();
  if(p==="admin") return renderAdmin();

  // fallback
  state.ui.page="dashboard";
  renderDashboard();
}

// TTS voice list bazÄ± cihazlarda geÃ§ geliyor
if("speechSynthesis" in window){
  speechSynthesis.onvoiceschanged = ()=> {
    loadVoices();
    if(state.ui.page==="voice") renderVoice();
  };
}

render();

// Ä°lk aÃ§Ä±lÄ±ÅŸ kÄ±sa bilgilendirme (1 kere)
if(!localStorage.getItem(LS.onboard)){
  setTimeout(()=>{
    alert("ARKO AI Platform (Demo)\n\nâ€¢ Ses StÃ¼dyosu: Metni cihaz sesiyle okur\nâ€¢ Fikir StÃ¼dyosu: Plan Ã¼retir (demo)\nâ€¢ Projeler: Kaydet / Export / Import\n\nSaÄŸ taraf kesilmez, menÃ¼ Ã§ekmeceden aÃ§Ä±lÄ±r.");
    localStorage.setItem(LS.onboard,"1");
  }, 500);
}
</script>

</body>
</html>
