<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VigoChatt</title>

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --accent:#3b82f6;
  --text:#f1f5f9;
  --muted:#94a3b8;
  --radius:16px;
}

body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:18px;
  font-weight:700;
  font-size:20px;
  background:var(--card);
  display:flex;
  justify-content:space-between;
}

.section{display:none;padding:20px;}
.section.active{display:block;}

.card{
  background:var(--card);
  padding:16px;
  border-radius:var(--radius);
  margin-bottom:16px;
}

input,textarea{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:10px;
  border:none;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:var(--accent);
  color:white;
  font-weight:600;
  cursor:pointer;
}

.nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  display:flex;
  justify-content:space-around;
  background:var(--card);
  padding:10px 0;
}

.nav div{
  cursor:pointer;
  font-size:13px;
}

.message{
  padding:10px;
  margin:6px 0;
  border-radius:10px;
  background:#334155;
}
.me{
  background:var(--accent);
  text-align:right;
}
</style>
</head>

<body>

<header>
  VigoChatt
  <div onclick="logout()" style="cursor:pointer;">Çıkış</div>
</header>

<!-- AUTH -->
<div id="authSection" class="section active">
  <div class="card">
    <h3>Giriş / Kayıt</h3>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Şifre">
    <button onclick="register()">Kayıt Ol</button>
    <button onclick="login()">Giriş Yap</button>
    <div id="authError" style="color:red;"></div>
  </div>
</div>

<!-- CHAT -->
<div id="chatSection" class="section">
  <div id="messages"></div>
  <input id="messageInput" placeholder="Mesaj yaz">
  <button onclick="sendMessage()">Gönder</button>
</div>

<!-- STATUS -->
<div id="statusSection" class="section">
  <input id="statusInput" placeholder="Durum yaz">
  <button onclick="addStatus()">Paylaş</button>
  <div id="statusList"></div>
</div>

<!-- PROFILE -->
<div id="profileSection" class="section">
  <div class="card">
    <input id="nameInput" placeholder="İsim">
    <input id="birthdayInput" type="date">
    <textarea id="bioInput" placeholder="Hakkında"></textarea>
    <button onclick="saveProfile()">Kaydet</button>
  </div>
</div>

<div class="nav">
  <div onclick="switchTab('chatSection')">Sohbet</div>
  <div onclick="switchTab('statusSection')">Durum</div>
  <div onclick="switchTab('profileSection')">Profil</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  getDatabase,
  ref,
  push,
  set,
  onValue,
  get
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA3--Xy1WrM6WlxurXXr4i5qwMZiafXN4k",
  authDomain: "vigochat-58144.firebaseapp.com",
  databaseURL: "https://vigochat-58144-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "vigochat-58144",
  storageBucket: "vigochat-58144.appspot.com",
  messagingSenderId: "384136632816",
  appId: "1:384136632816:web:2bb6d6942680a2e2e6e535"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUser=null;

onAuthStateChanged(auth, user=>{
  if(user){
    currentUser=user;
    document.getElementById("authSection").classList.remove("active");
    switchTab("chatSection");
    loadMessages();
    loadStatuses();
    loadProfile();
  }else{
    document.getElementById("authSection").classList.add("active");
  }
});

window.register = async function(){
  try{
    await createUserWithEmailAndPassword(auth,email.value,password.value);
  }catch(e){
    authError.innerText=e.message;
  }
}

window.login = async function(){
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
  }catch(e){
    authError.innerText=e.message;
  }
}

window.logout = function(){
  signOut(auth);
}

window.switchTab = function(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function loadMessages(){
  const msgRef = ref(db,"messages");
  onValue(msgRef,snapshot=>{
    const data=snapshot.val();
    messages.innerHTML="";
    if(!data)return;
    Object.values(data).forEach(msg=>{
      const div=document.createElement("div");
      div.className="message";
      if(msg.uid===currentUser.uid) div.classList.add("me");
      div.innerText=msg.text;
      messages.appendChild(div);
    });
  });
}

window.sendMessage=function(){
  const text=messageInput.value;
  if(!text)return;
  push(ref(db,"messages"),{
    text:text,
    uid:currentUser.uid,
    time:Date.now()
  });
  messageInput.value="";
}

window.addStatus=function(){
  const text=statusInput.value;
  if(!text)return;
  push(ref(db,"statuses/"+currentUser.uid),{
    text:text,
    time:Date.now()
  });
  statusInput.value="";
}

function loadStatuses(){
  onValue(ref(db,"statuses"),snapshot=>{
    const data=snapshot.val();
    statusList.innerHTML="";
    if(!data)return;
    for(let uid in data){
      Object.values(data[uid]).forEach(st=>{
        const div=document.createElement("div");
        div.className="card";
        div.innerText=st.text;
        statusList.appendChild(div);
      });
    }
  });
}

window.saveProfile=async function(){
  await set(ref(db,"users/"+currentUser.uid),{
    name:nameInput.value,
    birthday:birthdayInput.value,
    bio:bioInput.value,
    email:currentUser.email
  });
}

function loadProfile(){
  get(ref(db,"users/"+currentUser.uid)).then(snapshot=>{
    const d=snapshot.val();
    if(!d)return;
    nameInput.value=d.name||"";
    birthdayInput.value=d.birthday||"";
    bioInput.value=d.bio||"";
  });
}

</script>
</body>
</html>
