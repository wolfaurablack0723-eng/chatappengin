<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VigoChat Pro</title>

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --accent:#3b82f6;
  --text:#f1f5f9;
}

body{
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:15px;
  background:var(--card);
  display:flex;
  justify-content:space-between;
}

button{
  padding:10px;
  border:none;
  background:var(--accent);
  color:white;
  cursor:pointer;
  border-radius:8px;
}

input{
  padding:10px;
  width:100%;
  margin-bottom:10px;
  border-radius:8px;
  border:none;
}

.section{
  padding:15px;
  display:none;
}

.active{
  display:block;
}

.message{
  background:#334155;
  padding:8px;
  margin-bottom:8px;
  border-radius:8px;
}

.nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:var(--card);
  display:flex;
  justify-content:space-around;
  padding:10px;
}

.nav div{
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <div>VigoChat</div>
  <button onclick="toggleTheme()">Tema</button>
</header>

<!-- AUTH -->
<div id="auth" class="section active">
  <h3>Giriş / Kayıt</h3>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Şifre">
  <button onclick="register()">Kayıt Ol</button>
  <button onclick="login()">Giriş Yap</button>
  <p id="authError" style="color:red;"></p>
</div>

<!-- CHAT -->
<div id="chat" class="section">
  <h3>Sohbet</h3>
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="Mesaj yaz">
  <button onclick="sendMessage()">Gönder</button>
</div>

<!-- PROFILE -->
<div id="profile" class="section">
  <h3>Profil</h3>
  <p id="userEmail"></p>
  <button onclick="logout()">Çıkış</button>
</div>

<div class="nav">
  <div onclick="showSection('chat')">Sohbet</div>
  <div onclick="showSection('profile')">Profil</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  getDatabase,
  ref,
  push,
  onValue,
  set
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA3--Xy1WrM6WlxurXXr4i5qwMZiafXN4k",
  authDomain: "vigochat-58144.firebaseapp.com",
  databaseURL: "https://vigochat-58144-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "vigochat-58144",
  storageBucket: "vigochat-58144.firebasestorage.app",
  messagingSenderId: "384136632816",
  appId: "1:384136632816:web:2bb6d6942680a2e2e6e535"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUser = null;

// AUTH STATE
onAuthStateChanged(auth, user=>{
  if(user){
    currentUser = user;
    document.getElementById("auth").classList.remove("active");
    document.getElementById("chat").classList.add("active");
    document.getElementById("userEmail").innerText = user.email;
    listenMessages();
    set(ref(db, "users/"+user.uid), {
      email:user.email,
      online:true
    });
  }else{
    document.getElementById("auth").classList.add("active");
    document.getElementById("chat").classList.remove("active");
  }
});

// REGISTER
window.register = async function(){
  const email = document.getElementById("email").value;
  const pass = document.getElementById("password").value;
  try{
    await createUserWithEmailAndPassword(auth,email,pass);
  }catch(e){
    document.getElementById("authError").innerText = e.message;
  }
}

// LOGIN
window.login = async function(){
  const email = document.getElementById("email").value;
  const pass = document.getElementById("password").value;
  try{
    await signInWithEmailAndPassword(auth,email,pass);
  }catch(e){
    document.getElementById("authError").innerText = e.message;
  }
}

// LOGOUT
window.logout = async function(){
  await signOut(auth);
}

// SEND MESSAGE
window.sendMessage = function(){
  const text = document.getElementById("messageInput").value;
  if(!text || !currentUser) return;
  push(ref(db,"messages"),{
    text:text,
    uid:currentUser.uid,
    email:currentUser.email,
    time:Date.now()
  });
  document.getElementById("messageInput").value="";
}

// LISTEN MESSAGES
function listenMessages(){
  onValue(ref(db,"messages"), snapshot=>{
    const data = snapshot.val();
    const container = document.getElementById("messages");
    container.innerHTML="";
    if(!data) return;
    Object.values(data).forEach(msg=>{
      const div=document.createElement("div");
      div.className="message";
      div.innerText=msg.email+": "+msg.text;
      container.appendChild(div);
    });
  });
}

// NAVIGATION
window.showSection=function(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// THEME
window.toggleTheme=function(){
  if(document.body.style.background=="white"){
    document.body.style.background="#0f172a";
  }else{
    document.body.style.background="white";
  }
}

</script>

</body>
</html>
