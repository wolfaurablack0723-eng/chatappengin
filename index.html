<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VigoChatt</title>

<style>
:root{
--bg:#0f172a;
--card:#1e293b;
--text:#f1f5f9;
--accent:#3b82f6;
--radius:16px;
}

body{
margin:0;
font-family:system-ui;
background:var(--bg);
color:var(--text);
}

.header{
padding:18px;
font-size:20px;
font-weight:700;
display:flex;
justify-content:space-between;
background:var(--card);
}

.container{
padding:20px;
}

.card{
background:var(--card);
padding:15px;
border-radius:var(--radius);
margin-bottom:15px;
}

input{
width:100%;
padding:12px;
border-radius:12px;
border:none;
margin-bottom:10px;
}

button{
padding:12px;
border-radius:12px;
border:none;
background:var(--accent);
color:white;
width:100%;
cursor:pointer;
}

.message{
padding:10px;
border-radius:12px;
margin-bottom:8px;
background:#334155;
}

.me{
background:var(--accent);
}

.light{
--bg:#f1f5f9;
--card:#ffffff;
--text:#111;
}

</style>
</head>

<body>

<div class="header">
VigoChatt
<button onclick="toggleTheme()">Tema</button>
</div>

<div class="container">

<div id="authSection">
<div class="card">
<input id="emailInput" placeholder="Email">
<input id="passInput" type="password" placeholder="Şifre">
<button onclick="registerUser()">Kayıt Ol</button>
<button onclick="loginUser()">Giriş Yap</button>
<div id="authError"></div>
</div>
</div>

<div id="chatSection" style="display:none">

<div class="card">
<input id="messageInput" placeholder="Mesaj yaz">
<button onclick="sendMessage()">Gönder</button>
</div>

<div id="messages"></div>

<div class="card">
<input id="statusInput" placeholder="Durum yaz">
<button onclick="addStatus()">Durum Paylaş</button>
</div>

<div id="statusList"></div>

<div class="card">
<input id="nameInput" placeholder="Profil İsmi">
<button onclick="saveProfile()">Profili Kaydet</button>
</div>

<button onclick="logoutUser()">Çıkış</button>

</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
getAuth,
createUserWithEmailAndPassword,
signInWithEmailAndPassword,
signOut,
onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
getFirestore,
collection,
addDoc,
onSnapshot,
doc,
setDoc,
getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyA3--Xy1WrM6WlxurXXr4i5qwMZiafXN4k",
authDomain: "vigochat-58144.firebaseapp.com",
projectId: "vigochat-58144"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const authSection = document.getElementById("authSection");
const chatSection = document.getElementById("chatSection");
const authError = document.getElementById("authError");

window.registerUser = async ()=>{
try{
await createUserWithEmailAndPassword(
auth,
document.getElementById("emailInput").value,
document.getElementById("passInput").value
);
}catch(e){ authError.innerText=e.message; }
};

window.loginUser = async ()=>{
try{
await signInWithEmailAndPassword(
auth,
document.getElementById("emailInput").value,
document.getElementById("passInput").value
);
}catch(e){ authError.innerText=e.message; }
};

window.logoutUser = ()=> signOut(auth);

onAuthStateChanged(auth, async user=>{
if(user){
authSection.style.display="none";
chatSection.style.display="block";
loadMessages();
loadStatus();
loadProfile();
}else{
authSection.style.display="block";
chatSection.style.display="none";
}
});

function loadMessages(){
onSnapshot(collection(db,"messages"),snap=>{
const box=document.getElementById("messages");
box.innerHTML="";
snap.forEach(d=>{
const m=d.data();
const div=document.createElement("div");
div.className="message";
div.innerText=m.text;
box.appendChild(div);
});
});
}

window.sendMessage = async ()=>{
const text=document.getElementById("messageInput").value;
if(!text) return;
await addDoc(collection(db,"messages"),{
text:text,
uid:auth.currentUser.uid
});
document.getElementById("messageInput").value="";
};

window.addStatus = async ()=>{
const text=document.getElementById("statusInput").value;
if(!text) return;
await addDoc(collection(db,"status"),{
text:text,
time:Date.now()
});
document.getElementById("statusInput").value="";
};

function loadStatus(){
onSnapshot(collection(db,"status"),snap=>{
const box=document.getElementById("statusList");
box.innerHTML="";
snap.forEach(d=>{
const div=document.createElement("div");
div.className="card";
div.innerText=d.data().text;
box.appendChild(div);
});
});
}

window.saveProfile = async ()=>{
const user=auth.currentUser;
await setDoc(doc(db,"users",user.uid),{
name:document.getElementById("nameInput").value
});
};

async function loadProfile(){
const user=auth.currentUser;
const snap=await getDoc(doc(db,"users",user.uid));
if(snap.exists()){
document.getElementById("nameInput").value=snap.data().name;
}
}

window.toggleTheme = ()=>{
document.body.classList.toggle("light");
};

</script>

</body>
</html>
