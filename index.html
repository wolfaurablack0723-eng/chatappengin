<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VigoChatt</title>

<style>
:root{
--bg:#f2f2f2;
--card:#ffffff;
--text:#111;
--accent:#2b6cff;
}
body.dark{
--bg:#111;
--card:#1e1e1e;
--text:#eee;
}
body{
margin:0;
font-family:Arial;
background:var(--bg);
color:var(--text);
}
.container{padding:20px;max-width:500px;margin:auto}
input,button{
width:100%;
padding:12px;
margin:6px 0;
border-radius:8px;
border:1px solid #ccc;
}
button{
background:var(--accent);
color:white;
border:none;
}
.card{
background:var(--card);
padding:15px;
border-radius:12px;
margin-top:15px;
}
#chatPage{display:none}
#messages{
height:300px;
overflow:auto;
background:var(--card);
padding:10px;
border-radius:10px;
}
.msg{margin:5px 0}
.top{display:flex;justify-content:space-between;align-items:center}
.smallBtn{
width:auto;
padding:6px 10px;
margin-left:5px;
}
</style>
</head>

<body>

<div class="container" id="authPage">
<h2>Giriş / Kayıt</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Şifre">
<button id="signupBtn">Kayıt Ol</button>
<button id="loginBtn">Giriş Yap</button>
<p id="error" style="color:red;"></p>
</div>

<div class="container" id="chatPage">

<div class="top">
<h3>VigoChatt</h3>
<div>
<button class="smallBtn" id="themeBtn">Tema</button>
<button class="smallBtn" id="logoutBtn">Çıkış</button>
</div>
</div>

<div class="card">
<input id="roomInput" placeholder="Oda adı (örn: genel)">
<button id="joinBtn">Odaya Gir</button>
</div>

<div id="messages"></div>

<input id="messageInput" placeholder="Mesaj yaz...">
<button id="sendBtn">Gönder</button>

<div class="card">
<h4>Profil</h4>
<input id="displayName" placeholder="Görünen ad">
<button id="saveNameBtn">Kaydet</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getDatabase, ref, push, onValue } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA3--Xy1WrM6WlxurXXr4i5qwMZiafXN4k",
  authDomain: "vigochat-58144.firebaseapp.com",
  databaseURL: "https://vigochat-58144-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "vigochat-58144",
  storageBucket: "vigochat-58144.firebasestorage.app",
  messagingSenderId: "384136632816",
  appId: "1:384136632816:web:2bb6d6942680a2e2e6e535"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentRoom = null;

signupBtn.onclick = () =>{
createUserWithEmailAndPassword(auth,email.value,password.value)
.catch(e=>error.innerText=e.message);
};

loginBtn.onclick = () =>{
signInWithEmailAndPassword(auth,email.value,password.value)
.catch(e=>error.innerText=e.message);
};

logoutBtn.onclick = ()=> signOut(auth);

onAuthStateChanged(auth,user=>{
if(user){
authPage.style.display="none";
chatPage.style.display="block";
}else{
authPage.style.display="block";
chatPage.style.display="none";
}
});

joinBtn.onclick = ()=>{
currentRoom = roomInput.value;
messages.innerHTML="";
const roomRef = ref(db,"rooms/"+currentRoom);
onValue(roomRef,(snapshot)=>{
messages.innerHTML="";
snapshot.forEach(child=>{
const msg = child.val();
messages.innerHTML += "<div class='msg'><b>"+msg.name+":</b> "+msg.text+"</div>";
});
messages.scrollTop = messages.scrollHeight;
});
};

sendBtn.onclick = ()=>{
if(!currentRoom) return;
if(!messageInput.value) return;

push(ref(db,"rooms/"+currentRoom),{
name: displayName.value || auth.currentUser.email,
text: messageInput.value
});
messageInput.value="";
};

themeBtn.onclick = ()=>{
document.body.classList.toggle("dark");
localStorage.setItem("theme",document.body.classList.contains("dark"));
};

if(localStorage.getItem("theme")==="true"){
document.body.classList.add("dark");
}

saveNameBtn.onclick = ()=>{
alert("İsim kaydedildi.");
};

</script>
</body>
</html>
