<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VigoChatt</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f2f2f2;
}
.wrap{
  max-width:500px;
  margin:0 auto;
  padding:20px;
}
.card{
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 20px rgba(0,0,0,.08);
  margin-bottom:20px;
}
input{
  width:100%;
  padding:10px;
  margin:8px 0;
  border:1px solid #ddd;
  border-radius:8px;
}
button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border:none;
  border-radius:8px;
  background:#2b6cff;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
.view{ display:none; }
.view.active{ display:block; }
#threadList div{
  padding:10px;
  border-bottom:1px solid #eee;
}
</style>

<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

</head>
<body>

<div class="wrap">

<section class="view active" id="view-auth">
<div class="card">
<h2>Giriş / Kayıt</h2>
<input id="email" type="email" placeholder="E-posta">
<input id="pass" type="password" placeholder="Şifre">
<button id="loginBtn">Giriş Yap</button>
<button id="signupBtn">Kayıt Ol</button>
<div id="authErr" style="color:red;margin-top:10px;"></div>
</div>
</section>

<section class="view" id="view-chats">
<div class="card">
<h2>Sohbetler</h2>
<div id="threadList"></div>
<button id="logoutBtn">Çıkış</button>
</div>
</section>
</div>

<script>

firebase.initializeApp({
  apiKey: "AIzaSyA3--Xy1WrM6WlxurXXr4i5qwMZiafXN4k",
  authDomain: "vigochat-58144.firebaseapp.com",
  projectId: "vigochat-58144"
});

const auth = firebase.auth();
const db = firebase.firestore();

function show(id){
  document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
  document.getElementById("view-"+id).classList.add("active");
}

auth.onAuthStateChanged(user=>{
  if(user){
    show("chats");
    loadThreads(user.uid);
  }else{
    show("auth");
  }
});

document.getElementById("loginBtn").onclick = async ()=>{
  try{
    await auth.signInWithEmailAndPassword(
      email.value.trim(),
      pass.value.trim()
    );
  }catch(e){
    authErr.textContent = e.message;
  }
};

document.getElementById("signupBtn").onclick = async ()=>{
  try{
    await auth.createUserWithEmailAndPassword(
      email.value.trim(),
      pass.value.trim()
    );
  }catch(e){
    authErr.textContent = e.message;
  }
};

document.getElementById("logoutBtn").onclick = ()=>{
  auth.signOut();
};

function loadThreads(uid){
  db.collection("threads")
    .where("participants","array-contains",uid)
    .onSnapshot(snap=>{
      threadList.innerHTML="";
      snap.forEach(doc=>{
        const div=document.createElement("div");
        div.innerText="Sohbet: "+doc.id;
        threadList.appendChild(div);
      });
    });
}

</script>

</body>
</html>
