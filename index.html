<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VigoChatt</title>

<style>
:root{
--bg:#0f172a;
--card:#1e293b;
--text:#f1f5f9;
--muted:#94a3b8;
--accent:#3b82f6;
--radius:18px;
}

body{
margin:0;
font-family:system-ui;
background:var(--bg);
color:var(--text);
}

.header{
padding:20px;
font-size:22px;
font-weight:700;
display:flex;
justify-content:space-between;
background:var(--card);
}

.container{
padding:20px;
}

.card{
background:var(--card);
padding:15px;
border-radius:var(--radius);
margin-bottom:15px;
}

input{
width:100%;
padding:12px;
border-radius:12px;
border:none;
margin-bottom:10px;
}

button{
padding:12px;
border-radius:12px;
border:none;
background:var(--accent);
color:white;
width:100%;
cursor:pointer;
}

.message{
background:#334155;
padding:10px;
border-radius:12px;
margin-bottom:10px;
}

.me{
background:var(--accent);
}

.themeLight{
--bg:#f1f5f9;
--card:#ffffff;
--text:#0f172a;
--muted:#64748b;
}

</style>
</head>

<body>

<div class="header">
VigoChatt
<button onclick="toggleTheme()">Tema</button>
</div>

<div class="container">

<div id="auth">
<div class="card">
<h3>Giriş / Kayıt</h3>
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Şifre">
<button onclick="login()">Giriş</button>
<button onclick="register()">Kayıt</button>
<div id="authErr"></div>
</div>
</div>

<div id="chat" style="display:none">

<div class="card">
<input id="msgInput" placeholder="Mesaj yaz...">
<button onclick="sendMessage()">Gönder</button>
</div>

<div id="messages"></div>

<div class="card">
<input id="statusInput" placeholder="Durum yaz">
<button onclick="addStatus()">Durum Paylaş</button>
</div>

<div id="statusList"></div>

<div class="card">
<h3>Profil</h3>
<input id="displayName" placeholder="İsim">
<button onclick="saveProfile()">Kaydet</button>
</div>

<button onclick="logout()">Çıkış</button>

</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
getAuth,
createUserWithEmailAndPassword,
signInWithEmailAndPassword,
signOut,
onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
getFirestore,
collection,
addDoc,
onSnapshot,
doc,
setDoc,
getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyA3--Xy1WrM6WlxurXXr4i5qwMZiafXN4k",
authDomain: "vigochat-58144.firebaseapp.com",
projectId: "vigochat-58144",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.register = async ()=>{
const email = email.value;
const pass = pass.value;
try{
await createUserWithEmailAndPassword(auth,email,pass);
}catch(e){ authErr.innerText = e.message }
};

window.login = async ()=>{
const email = email.value;
const pass = pass.value;
try{
await signInWithEmailAndPassword(auth,email,pass);
}catch(e){ authErr.innerText = e.message }
};

window.logout = ()=> signOut(auth);

onAuthStateChanged(auth, async user=>{
if(user){
auth.style.display="none";
chat.style.display="block";
loadMessages();
loadStatus();
loadProfile();
}else{
auth.style.display="block";
chat.style.display="none";
}
});

async function loadMessages(){
const col = collection(db,"messages");
onSnapshot(col,snap=>{
messages.innerHTML="";
snap.forEach(d=>{
const div = document.createElement("div");
div.className="message";
div.innerText=d.data().text;
messages.appendChild(div);
});
});
}

window.sendMessage = async ()=>{
if(!auth.currentUser) return;
await addDoc(collection(db,"messages"),{
text:msgInput.value,
uid:auth.currentUser.uid
});
msgInput.value="";
};

window.addStatus = async ()=>{
await addDoc(collection(db,"status"),{
text:statusInput.value,
time:Date.now()
});
statusInput.value="";
};

function loadStatus(){
onSnapshot(collection(db,"status"),snap=>{
statusList.innerHTML="";
snap.forEach(d=>{
const div=document.createElement("div");
div.className="card";
div.innerText=d.data().text;
statusList.appendChild(div);
});
});
}

window.saveProfile = async ()=>{
const user=auth.currentUser;
await setDoc(doc(db,"users",user.uid),{
name:displayName.value
});
};

async function loadProfile(){
const user=auth.currentUser;
const snap=await getDoc(doc(db,"users",user.uid));
if(snap.exists()){
displayName.value=snap.data().name;
}
}

window.toggleTheme = ()=>{
document.body.classList.toggle("themeLight");
};

</script>

</body>
</html>
