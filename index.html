<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VigoChat</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
body{font-family:Arial;padding:20px}
input,button{padding:10px;margin:5px;width:100%}
button{background:#2b6cff;color:white;border:none}
#chat{display:none;margin-top:20px}
</style>
</head>
<body>

<h2>Giriş / Kayıt</h2>

<input type="email" id="email" placeholder="Email">
<input type="password" id="pass" placeholder="Şifre">
<button onclick="login()">Giriş</button>
<button onclick="signup()">Kayıt</button>

<p id="error" style="color:red;"></p>

<div id="chat">
<h2>Sohbet</h2>
<input id="msg" placeholder="Mesaj yaz">
<button onclick="send()">Gönder</button>
<button onclick="logout()">Çıkış</button>
<div id="messages"></div>
</div>

<script>

var firebaseConfig = {
  apiKey: "AIzaSyA3--Xy1WrM6WlxurXXr4i5qwMZiafXN4k",
  authDomain: "vigochat-58144.firebaseapp.com",
  databaseURL: "https://vigochat-58144-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "vigochat-58144",
  storageBucket: "vigochat-58144.appspot.com",
  messagingSenderId: "384136632816",
  appId: "1:384136632816:web:2bb6d6942680a2e2e6e535"
};

firebase.initializeApp(firebaseConfig);

var auth = firebase.auth();
var db = firebase.database();

function signup(){
  auth.createUserWithEmailAndPassword(
    email.value, pass.value
  ).catch(e=> error.innerText = e.message);
}

function login(){
  auth.signInWithEmailAndPassword(
    email.value, pass.value
  ).catch(e=> error.innerText = e.message);
}

function logout(){
  auth.signOut();
}

function send(){
  if(!msg.value) return;
  db.ref("messages").push({
    user: auth.currentUser.email,
    text: msg.value
  });
  msg.value="";
}

auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById("chat").style.display="block";
    db.ref("messages").on("value",snap=>{
      messages.innerHTML="";
      snap.forEach(child=>{
        messages.innerHTML += "<p><b>"+child.val().user+"</b>: "+child.val().text+"</p>";
      });
    });
  }else{
    document.getElementById("chat").style.display="none";
  }
});

</script>

</body>
</html>
