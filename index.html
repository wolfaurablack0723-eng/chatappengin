<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VigoChatt</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f2f2f2}
.wrap{max-width:500px;margin:auto;padding:20px}
.card{background:white;padding:20px;border-radius:10px;margin-bottom:15px}
input,button{width:100%;padding:10px;margin:5px 0}
button{background:#2b6cff;color:white;border:none;border-radius:5px}
.msg{padding:8px;background:#e9e9e9;margin:5px 0;border-radius:5px}
.me{background:#cfe2ff}
</style>
</head>
<body>

<div class="wrap">

<div class="card">
<h2>Giriş / Kayıt</h2>
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Şifre">
<button onclick="login()">Giriş</button>
<button onclick="signup()">Kayıt</button>
<div id="authErr" style="color:red"></div>
</div>

<div class="card">
<h2>Sohbet</h2>
<div id="messages"></div>
<input id="msgInput" placeholder="Mesaj yaz">
<button onclick="sendMsg()">Gönder</button>
<button onclick="logout()">Çıkış</button>
</div>

</div>

<script>

const firebaseConfig = {
  apiKey: "AZASYBLiQkV4BNrAFILe-VkURhx31AsnxLQ8",
  authDomain: "vigochatt.firebaseapp.com",
  projectId: "vigochatt",
  storageBucket: "vigochatt.firebasestorage.app",
  messagingSenderId: "12259504636",
  appId: "1:12259504636:web:d6ee79daceac8834d70279"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

auth.onAuthStateChanged(user=>{
    if(user){
        currentUser = user;
        loadMessages();
    }else{
        currentUser = null;
        document.getElementById("messages").innerHTML="";
    }
});

function login(){
    const email = document.getElementById("email").value;
    const pass = document.getElementById("pass").value;
    auth.signInWithEmailAndPassword(email,pass)
    .catch(e=>document.getElementById("authErr").innerText=e.message);
}

function signup(){
    const email = document.getElementById("email").value;
    const pass = document.getElementById("pass").value;
    auth.createUserWithEmailAndPassword(email,pass)
    .catch(e=>document.getElementById("authErr").innerText=e.message);
}

function logout(){
    auth.signOut();
}

function sendMsg(){
    if(!currentUser) return alert("Önce giriş yap");
    const text = document.getElementById("msgInput").value;
    if(!text) return;

    db.collection("messages").add({
        uid: currentUser.uid,
        email: currentUser.email,
        text: text,
        created: firebase.firestore.FieldValue.serverTimestamp()
    });

    document.getElementById("msgInput").value="";
}

function loadMessages(){
    db.collection("messages")
    .orderBy("created")
    .onSnapshot(snapshot=>{
        const container=document.getElementById("messages");
        container.innerHTML="";
        snapshot.forEach(doc=>{
            const m=doc.data();
            const div=document.createElement("div");
            div.className="msg";
            if(m.uid===currentUser.uid) div.classList.add("me");
            div.innerText=m.email+": "+m.text;
            container.appendChild(div);
        });
    });
}

</script>
</body>
</html>
