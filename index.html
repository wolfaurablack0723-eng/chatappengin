<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Vigo Chat</title>
  <style>
    :root{
      --bg1:#fbf3e6;
      --bg2:#f6ead8;
      --card: rgba(255,255,255,.78);
      --stroke: rgba(0,0,0,.07);
      --text: #1f1f1f;
      --muted: rgba(0,0,0,.55);
      --accent:#2a7cff;
      --accent2:#ffb347;
      --shadow: 0 10px 30px rgba(0,0,0,.07);
      --radius:18px;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-top: env(safe-area-inset-top, 0px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 60% 10%, rgba(255,255,255,.85), transparent 60%),
        radial-gradient(900px 600px at 10% 90%, rgba(255,255,255,.55), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }
    .app{
      max-width:520px;
      margin:0 auto;
      height:100dvh;
      display:flex;
      flex-direction:column;
      padding-top: calc(10px + var(--safe-top));
      padding-bottom: calc(84px + var(--safe-bottom));
    }
    header{
      padding: 14px 16px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    header .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    header h1{
      margin:0;
      font-size:20px;
      letter-spacing:.2px;
    }
    header small{color:var(--muted)}
    .pill{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.55);
      padding:9px 12px;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 6px 18px rgba(0,0,0,.05);
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:600;
    }
    .pill:active{transform:scale(.98)}
    .views{flex:1; overflow:hidden; padding: 0 12px;}
    .view{display:none; height:100%; overflow:auto; padding: 6px 4px 10px;}
    .view.active{display:block}
    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:14px;
      box-shadow: var(--shadow);
    }
    .card + .card{margin-top:12px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .muted{color:var(--muted)}
    .list{margin-top:10px; display:flex; flex-direction:column; gap:10px}
    .item{
      background: rgba(255,255,255,.70);
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      gap:12px;
      align-items:center;
      cursor:pointer;
      box-shadow: 0 8px 22px rgba(0,0,0,.05);
    }
    .item:active{transform:scale(.99)}
    .avatar{
      width:46px; height:46px;
      border-radius:14px;
      background: rgba(42,124,255,.12);
      border:1px solid rgba(42,124,255,.20);
      display:grid; place-items:center;
      font-weight:800;
      color: var(--accent);
      flex:0 0 auto;
    }
    .item .meta{min-width:0; flex:1}
    .item .name{font-weight:800; margin:0 0 2px}
    .item .last{
      margin:0;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:100%;
    }
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.6);
      color: var(--muted);
      font-weight:700;
      flex:0 0 auto;
    }

    /* bottom nav */
    .nav{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom: calc(10px + var(--safe-bottom));
      width:min(520px, calc(100% - 20px));
      background: rgba(255,255,255,.70);
      border:1px solid var(--stroke);
      border-radius: 20px;
      box-shadow: 0 18px 45px rgba(0,0,0,.10);
      display:flex;
      padding:8px;
      gap:8px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .tab{
      flex:1;
      border-radius:16px;
      padding:10px 8px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      cursor:pointer;
      user-select:none;
      color: rgba(0,0,0,.55);
      font-weight:700;
      font-size:12px;
      border:1px solid transparent;
    }
    .tab .ico{font-size:18px; line-height:1}
    .tab.active{
      color: var(--accent);
      background: rgba(42,124,255,.10);
      border-color: rgba(42,124,255,.18);
    }

    /* floating add button */
    .fab{
      position:fixed;
      right: calc(12px + max(0px, env(safe-area-inset-right, 0px)));
      top: calc(20px + var(--safe-top));
      width:46px; height:46px;
      border-radius: 18px;
      background: rgba(255,255,255,.80);
      border:1px solid var(--stroke);
      box-shadow: 0 12px 30px rgba(0,0,0,.10);
      display:grid; place-items:center;
      cursor:pointer;
      user-select:none;
      font-size:22px;
      font-weight:900;
    }
    .fab:active{transform:scale(.98)}

    /* chat screen */
    .chatTop{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 2px 2px 10px;
      position:sticky;
      top:0;
      background: linear-gradient(180deg, rgba(251,243,230,.95), rgba(251,243,230,.0));
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      z-index:2;
    }
    .backBtn{
      width:42px;height:42px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.65);
      display:grid; place-items:center;
      cursor:pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.06);
      user-select:none;
      font-weight:900;
    }
    .chatTitle{min-width:0}
    .chatTitle .nm{margin:0;font-weight:900}
    .chatTitle .st{margin:0;color:var(--muted);font-size:12px}
    .bubbleWrap{display:flex; flex-direction:column; gap:8px; padding: 6px 4px 90px;}
    .brow{display:flex}
    .b{
      max-width: 78%;
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      box-shadow: 0 8px 22px rgba(0,0,0,.05);
      background: rgba(255,255,255,.78);
      line-height:1.25;
      word-break:break-word;
      position:relative;
    }
    .b.me{
      margin-left:auto;
      background: rgba(42,124,255,.13);
      border-color: rgba(42,124,255,.18);
    }
    .time{
      display:block;
      margin-top:6px;
      font-size:11px;
      color: rgba(0,0,0,.45);
      text-align:right;
    }
    .composer{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom: calc(84px + var(--safe-bottom));
      width:min(520px, calc(100% - 20px));
      padding: 10px;
      background: rgba(255,255,255,.78);
      border:1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(0,0,0,.10);
      display:none;
      gap:10px;
      align-items:center;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .composer.show{display:flex}
    .composer input{
      flex:1;
      border-radius: 14px;
      border:1px solid var(--stroke);
      padding: 12px 12px;
      outline:none;
      font-size:15px;
      background: rgba(255,255,255,.85);
    }
    .sendBtn{
      border:none;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight:900;
      cursor:pointer;
      background: var(--accent);
      color:white;
      box-shadow: 0 12px 26px rgba(42,124,255,.22);
    }
    .sendBtn:active{transform:scale(.98)}

    /* modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.25);
      display:none;
      padding: 18px;
      z-index:10;
    }
    .overlay.show{display:flex; align-items:center; justify-content:center}
    .modal{
      width:min(520px, 100%);
      background: rgba(255,255,255,.92);
      border:1px solid var(--stroke);
      border-radius: 22px;
      box-shadow: 0 30px 80px rgba(0,0,0,.20);
      padding: 16px;
    }
    .modal h3{margin:0 0 10px}
    .modal .grid{display:grid; gap:10px}
    .modal input, .modal textarea, .modal select{
      width:100%;
      border-radius: 14px;
      border:1px solid var(--stroke);
      padding: 12px 12px;
      outline:none;
      font-size:15px;
      background: rgba(255,255,255,.92);
    }
    .modal textarea{min-height:90px; resize:none}
    .modal .actions{display:flex; gap:10px; justify-content:flex-end; margin-top:12px}
    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      border-radius: 14px;
      padding: 10px 14px;
      cursor:pointer;
      font-weight:900;
    }
    .btn.primary{
      background: var(--accent);
      color:#fff;
      border-color: rgba(42,124,255,.2);
    }
    .btn:active{transform:scale(.98)}

    .smallNote{font-size:12px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <h1 id="hdrTitle">Mesajlar</h1>
        <small id="hdrSub">Basit mesajla≈üma</small>
      </div>
      <div class="pill" id="hdrAction" title="Hƒ±zlƒ± i≈ülem">
        <span id="hdrActionIco">‚ûï</span>
        <span id="hdrActionTxt">Yeni</span>
      </div>
    </header>

    <div class="views">
      <!-- CALLS -->
      <section class="view" id="v_calls">
        <div class="card">
          <div class="row">
            <div>
              <div style="font-weight:900;">Aramalar</div>
              <div class="muted" style="margin-top:4px;">Son aramalar burada g√∂r√ºnecek.</div>
            </div>
            <span class="badge">demo</span>
          </div>
        </div>
        <div class="list" id="callsList"></div>
      </section>

      <!-- STATUS -->
      <section class="view" id="v_status">
        <div class="card">
          <div class="row">
            <div>
              <div style="font-weight:900;">Durum</div>
              <div class="muted" style="margin-top:4px;">Hikaye/durum mantƒ±ƒüƒ± (basit).</div>
            </div>
            <span class="badge" id="myStatusBadge">‚Äî</span>
          </div>
        </div>
        <div class="list" id="statusList"></div>
      </section>

      <!-- CHATS -->
      <section class="view" id="v_chats">
        <div class="card">
          <div style="font-weight:900;">Mesajlar</div>
          <div class="muted" style="margin-top:4px;">Bir sohbet se√ß ‚Äî mesaj yazƒ±p g√∂nderebilirsin.</div>
        </div>
        <div class="list" id="chatList"></div>
      </section>

      <!-- PROFILE -->
      <section class="view" id="v_profile">
        <div class="card">
          <div class="row">
            <div style="display:flex;align-items:center;gap:12px;min-width:0;">
              <div class="avatar" id="meAvatar">üôÇ</div>
              <div style="min-width:0;">
                <div style="font-weight:900;" id="meName">Engin</div>
                <div class="muted" id="meBio">Durum: √ßevrimi√ßi</div>
              </div>
            </div>
            <span class="badge">Profil</span>
          </div>
        </div>

        <div class="card">
          <div style="font-weight:900;margin-bottom:8px;">Ayarlar</div>
          <div class="muted">Adƒ±nƒ±/durumunu deƒüi≈ütir, kalƒ±cƒ± kaydedilir.</div>
          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn" id="btnEditProfile">Profili D√ºzenle</button>
            <button class="btn" id="btnReset">Verileri Sƒ±fƒ±rla</button>
          </div>
          <div class="smallNote">Not: Bu s√ºr√ºm sunucusuz (offline). Ger√ßek WhatsApp gibi olmasƒ± i√ßin ileride Firebase ekleriz.</div>
        </div>
      </section>

      <!-- CHAT THREAD (inside views for layout) -->
      <section class="view" id="v_thread">
        <div class="chatTop">
          <div class="backBtn" id="btnBack">‚Üê</div>
          <div class="avatar" id="thAvatar">A</div>
          <div class="chatTitle">
            <p class="nm" id="thName">Ki≈üi</p>
            <p class="st" id="thSub">yazƒ±yor‚Ä¶</p>
          </div>
        </div>
        <div class="bubbleWrap" id="threadWrap"></div>
      </section>
    </div>
  </div>

  <div class="nav" id="nav">
    <div class="tab" data-tab="calls"><div class="ico">üë•</div><div>Aramalar</div></div>
    <div class="tab" data-tab="status"><div class="ico">‚ùó</div><div>Durum</div></div>
    <div class="tab active" data-tab="chats"><div class="ico">üí¨</div><div>Mesajlar</div></div>
    <div class="tab" data-tab="profile"><div class="ico">ü§î</div><div>Profil</div></div>
  </div>

  <div class="fab" id="fab" title="Yeni">+</div>

  <div class="composer" id="composer">
    <input id="msgInput" type="text" placeholder="Mesaj yaz‚Ä¶"/>
    <button class="sendBtn" id="sendBtn">G√∂nder</button>
  </div>

  <div class="overlay" id="overlay">
    <div class="modal" id="modal">
      <h3 id="modalTitle">Yeni</h3>
      <div class="grid" id="modalBody"></div>
      <div class="actions">
        <button class="btn" id="modalCancel">Vazge√ß</button>
        <button class="btn primary" id="modalOk">Kaydet</button>
      </div>
    </div>
  </div>

  <script>
    // ---------- Storage helpers ----------
    const LS = {
      get(k, fallback){
        try{
          const v = localStorage.getItem(k);
          return v ? JSON.parse(v) : fallback;
        }catch(e){ return fallback; }
      },
      set(k, v){
        localStorage.setItem(k, JSON.stringify(v));
      }
    };

    // ---------- Initial seed ----------
    const seed = () => {
      const has = LS.get("vigo_inited", false);
      if(has) return;

      const now = Date.now();
      const chats = [
        {
          id: "c_ahmet",
          name: "Ahmet",
          status: "√ßevrimi√ßi",
          avatar: "A",
          messages: [
            { id: "m1", me:false, text:"Nasƒ±lsƒ±n?", ts: now - 1000*60*60*3 }
          ]
        },
        {
          id: "c_zeynep",
          name: "Zeynep",
          status: "son g√∂r√ºlme: d√ºn",
          avatar: "Z",
          messages: [
            { id: "m1", me:false, text:"Yarƒ±n g√∂r√º≈ü√ºr√ºz.", ts: now - 1000*60*60*10 }
          ]
        },
        {
          id: "c_mert",
          name: "Mert",
          status: "me≈ügul",
          avatar: "M",
          messages: [
            { id: "m1", me:false, text:"Tamamdƒ±r.", ts: now - 1000*60*40 }
          ]
        }
      ];

      const statuses = [
        { id:"s_me", name:"Senin durumun", text:"Durum ekle", ts: now - 1000*60*5, mine:true, pin:true },
        { id:"s_a", name:"Ahmet", text:"Dƒ±≈üarƒ±dayƒ±m", ts: now - 1000*60*30, mine:false },
      ];

      const calls = [
        { id:"k1", name:"Ahmet", type:"Gelen", ts: now - 1000*60*60*2 },
        { id:"k2", name:"Zeynep", type:"Giden", ts: now - 1000*60*60*20 },
      ];

      const me = { name:"Engin", bio:"√ßevrimi√ßi", emoji:"üôÇ", myStatus:"‚Äî" };

      LS.set("vigo_chats", chats);
      LS.set("vigo_statuses", statuses);
      LS.set("vigo_calls", calls);
      LS.set("vigo_me", me);
      LS.set("vigo_inited", true);
    };

    seed();

    // ---------- State ----------
    let currentTab = "chats";
    let currentChatId = null;

    // ---------- Elements ----------
    const hdrTitle = document.getElementById("hdrTitle");
    const hdrSub = document.getElementById("hdrSub");
    const hdrAction = document.getElementById("hdrAction");
    const hdrActionIco = document.getElementById("hdrActionIco");
    const hdrActionTxt = document.getElementById("hdrActionTxt");

    const fab = document.getElementById("fab");
    const nav = document.getElementById("nav");

    const views = {
      calls: document.getElementById("v_calls"),
      status: document.getElementById("v_status"),
      chats: document.getElementById("v_chats"),
      profile: document.getElementById("v_profile"),
      thread: document.getElementById("v_thread"),
    };

    const chatList = document.getElementById("chatList");
    const callsList = document.getElementById("callsList");
    const statusList = document.getElementById("statusList");

    const meAvatar = document.getElementById("meAvatar");
    const meName = document.getElementById("meName");
    const meBio = document.getElementById("meBio");
    const myStatusBadge = document.getElementById("myStatusBadge");

    const composer = document.getElementById("composer");
    const msgInput = document.getElementById("msgInput");
    const sendBtn = document.getElementById("sendBtn");

    const btnBack = document.getElementById("btnBack");
    const thAvatar = document.getElementById("thAvatar");
    const thName = document.getElementById("thName");
    const thSub = document.getElementById("thSub");
    const threadWrap = document.getElementById("threadWrap");

    // modal
    const overlay = document.getElementById("overlay");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");
    const modalCancel = document.getElementById("modalCancel");
    const modalOk = document.getElementById("modalOk");

    // ---------- Utils ----------
    const pad2 = (n) => String(n).padStart(2,"0");
    const fmtTime = (ts) => {
      const d = new Date(ts);
      return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
    };
    const fmtWhen = (ts) => {
      const d = new Date(ts);
      const now = new Date();
      const sameDay = d.toDateString() === now.toDateString();
      if(sameDay) return `Bug√ºn ${fmtTime(ts)}`;
      const yest = new Date(Date.now() - 86400000);
      if(d.toDateString() === yest.toDateString()) return `D√ºn ${fmtTime(ts)}`;
      return `${pad2(d.getDate())}.${pad2(d.getMonth()+1)}.${d.getFullYear()} ${fmtTime(ts)}`;
    };

    const getChats = () => LS.get("vigo_chats", []);
    const setChats = (v) => LS.set("vigo_chats", v);

    const getStatuses = () => LS.get("vigo_statuses", []);
    const setStatuses = (v) => LS.set("vigo_statuses", v);

    const getCalls = () => LS.get("vigo_calls", []);
    const setCalls = (v) => LS.set("vigo_calls", v);

    const getMe = () => LS.get("vigo_me", {name:"Engin", bio:"√ßevrimi√ßi", emoji:"üôÇ", myStatus:"‚Äî"});
    const setMe = (v) => LS.set("vigo_me", v);

    const firstLetter = (s) => (s || "?").trim().charAt(0).toUpperCase() || "?";

    // ---------- Render ----------
    function setHeaderFor(tab){
      if(tab === "calls"){
        hdrTitle.textContent = "Aramalar";
        hdrSub.textContent = "Basit mesajla≈üma";
        hdrActionIco.textContent = "‚ûï";
        hdrActionTxt.textContent = "Ekle";
      } else if(tab === "status"){
        hdrTitle.textContent = "Durum";
        hdrSub.textContent = "Basit mesajla≈üma";
        hdrActionIco.textContent = "‚ûï";
        hdrActionTxt.textContent = "Ekle";
      } else if(tab === "chats"){
        hdrTitle.textContent = "Mesajlar";
        hdrSub.textContent = "Basit mesajla≈üma";
        hdrActionIco.textContent = "‚ûï";
        hdrActionTxt.textContent = "Yeni";
      } else if(tab === "profile"){
        hdrTitle.textContent = "Profil";
        hdrSub.textContent = "Basit mesajla≈üma";
        hdrActionIco.textContent = "‚öôÔ∏è";
        hdrActionTxt.textContent = "Ayar";
      } else if(tab === "thread"){
        hdrTitle.textContent = "Sohbet";
        hdrSub.textContent = "";
        hdrActionIco.textContent = "‚ãØ";
        hdrActionTxt.textContent = "Men√º";
      }
    }

    function showView(name){
      Object.values(views).forEach(v => v.classList.remove("active"));
      views[name].classList.add("active");

      // composer only in thread
      if(name === "thread"){
        composer.classList.add("show");
        nav.style.display = "none";
        fab.style.display = "none";
      }else{
        composer.classList.remove("show");
        nav.style.display = "flex";
        fab.style.display = "grid";
      }
    }

    function setActiveTab(tab){
      currentTab = tab;
