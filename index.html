<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>VigoChatt</title>

<style>
body{margin:0;font-family:system-ui;background:#f2f2f2;}
.top{padding:15px;background:#2b6cff;color:#fff;text-align:center;font-weight:bold;}
.box{padding:15px;background:#fff;}
input{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ddd;border-radius:6px;}
button{width:100%;padding:12px;background:#2b6cff;color:#fff;border:none;border-radius:6px;font-weight:bold;}
#messages{height:50vh;overflow:auto;padding:10px;background:#fff;}
.msg{padding:8px 10px;margin:5px 0;border-radius:8px;background:#eee;font-size:14px;}
.me{background:#2b6cff;color:#fff;text-align:right;}
</style>
</head>

<body>

<div class="top">VigoChatt</div>

<div class="box">
<input id="name" placeholder="Takma ad"/>
<input id="room" placeholder="Oda adı (örn: genel)"/>
<button onclick="join()">Sohbete Gir</button>
</div>

<div id="chat" style="display:none;">
<div id="messages"></div>
<div class="box">
<input id="messageInput" placeholder="Mesaj yaz..."/>
<button onclick="sendMessage()">Gönder</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB1qovN4BNfaFlvE-KvURhX31AshxLuc0",
  authDomain: "vigochatt.firebaseapp.com",
  projectId: "vigochatt",
  storageBucket: "vigochatt.firebasestorage.app",
  messagingSenderId: "12259504636",
  appId: "1:12259504636:web:d6ee79daceac8834d70279"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentRoom = "";
let currentName = "";

window.join = function(){
  currentName = document.getElementById("name").value.trim();
  currentRoom = document.getElementById("room").value.trim();
  if(!currentName || !currentRoom) return alert("Bilgileri doldur");

  document.querySelector(".box").style.display="none";
  document.getElementById("chat").style.display="block";

  const q = query(collection(db,"rooms",currentRoom,"messages"), orderBy("time"));
  onSnapshot(q,(snapshot)=>{
    const messagesDiv = document.getElementById("messages");
    messagesDiv.innerHTML="";
    snapshot.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement("div");
      div.className="msg";
      if(data.name===currentName) div.classList.add("me");
      div.innerText = data.name + ": " + data.text;
      messagesDiv.appendChild(div);
    });
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
}

window.sendMessage = async function(){
  const input = document.getElementById("messageInput");
  const text = input.value.trim();
  if(!text) return;

  await addDoc(collection(db,"rooms",currentRoom,"messages"),{
    name: currentName,
    text: text,
    time: Date.now()
  });

  input.value="";
}
</script>

</body>
</html>
