<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { 
getFirestore, 
collection, 
addDoc, 
query, 
orderBy, 
onSnapshot 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyA3--Xy1WrM6WlxurXXr4i5qwMZiafXN4k",
authDomain: "vigochat-58144.firebaseapp.com",
projectId: "vigochat-58144"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;

// Anonim giriş (test için)
signInAnonymously(auth);

onAuthStateChanged(auth, user=>{
if(user){
currentUser = user;
listenMessages();
}
});

function listenMessages(){
const q = query(collection(db,"messages"), orderBy("time"));
onSnapshot(q, snap=>{
const box = document.getElementById("chatBody");
box.innerHTML="";
snap.forEach(doc=>{
const m = doc.data();
const div = document.createElement("div");
div.className = "bubble " + (m.uid===currentUser.uid ? "me":"");
div.textContent = m.text;
box.appendChild(div);
});
box.scrollTop = box.scrollHeight;
});
}

window.sendMsg = async ()=>{
const input = document.getElementById("msg");
const text = input.value.trim();
if(!text) return;

await addDoc(collection(db,"messages"),{
text:text,
uid:currentUser.uid,
time:Date.now()
});

input.value="";
};

</script>
